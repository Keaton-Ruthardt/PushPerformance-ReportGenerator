# üöÄ Render Deployment Checklist

Quick checklist to deploy Push Performance App to Render.

## ‚úÖ Pre-Deployment Checklist

### 1. Code Preparation
- [ ] All code is committed to Git
- [ ] Code is pushed to GitHub
- [ ] `.env` file is NOT committed (in `.gitignore`)
- [ ] `vald-ref-data-copy-0c0792ad4944.json` is NOT committed (in `.gitignore`)

### 2. Files Ready
- [ ] `render.yaml` exists in project root
- [ ] `package.json` has `build` and `start` scripts
- [ ] `.gitignore` includes `client/dist/`, `.env`, `*.json` credentials

### 3. Credentials Ready
- [ ] VALD API Client ID
- [ ] VALD API Client Secret
- [ ] VALD API Username
- [ ] VALD API Password
- [ ] VALD Primary Token (optional)
- [ ] VALD Secondary Token (optional)
- [ ] BigQuery credentials JSON file
- [ ] Trainer password (for login)

## üì¶ Deployment Steps

### Step 1: Push to GitHub
```bash
cd "C:\Users\Jkeat\Push Performance\push-performance-app"
git add .
git commit -m "Prepare for Render deployment"
git push origin main
```

### Step 2: Create Render Service
1. Go to https://dashboard.render.com
2. Click "New +" ‚Üí "Blueprint" (or "Web Service")
3. Connect your GitHub repository
4. Render detects `render.yaml` automatically

### Step 3: Set Environment Variables

Go to Environment tab and add these (copy from `ENV_VARIABLES.md`):

**Critical Variables:**
```
NODE_ENV=production
JWT_SECRET=<click Generate>
TRAINER_PASSWORD=<your-password>
VALD_CLIENT_ID=<from-vald>
VALD_CLIENT_SECRET=<from-vald>
VALD_USERNAME=<from-vald>
VALD_PASSWORD=<from-vald>
GOOGLE_APPLICATION_CREDENTIALS=/etc/secrets/bigquery-credentials.json
```

**See `ENV_VARIABLES.md` for complete list**

### Step 4: Upload BigQuery Credentials

1. Environment tab ‚Üí "Secret Files"
2. Click "Add Secret File"
3. Path: `/etc/secrets/bigquery-credentials.json`
4. Content: Paste entire JSON from `vald-ref-data-copy-0c0792ad4944.json`

### Step 5: Add Disk for Puppeteer

1. Go to "Disks" tab
2. Add disk:
   - Name: `puppeteer-cache`
   - Mount Path: `/opt/render/.cache`
   - Size: 1 GB

### Step 6: Deploy

1. Click "Create Web Service" or "Manual Deploy"
2. Wait 5-10 minutes for build to complete
3. Check logs for any errors

## ‚úÖ Post-Deployment Checklist

### Verify Deployment

- [ ] Health check works: `https://your-app.onrender.com/health`
- [ ] Frontend loads: Visit `https://your-app.onrender.com`
- [ ] Login works with trainer credentials
- [ ] Can search for athletes
- [ ] Can generate reports
- [ ] PDF download works
- [ ] No errors in Render logs

### Test Features

- [ ] Athlete search returns results
- [ ] All test types display correctly
- [ ] Spider charts render
- [ ] Metric selector works (CMJ)
- [ ] PDF generation completes successfully
- [ ] Percentiles display correctly

## üêõ Common Issues & Fixes

### Build Fails

**Error**: `Cannot find module`
- **Fix**: Check all dependencies in `package.json`
- Run `npm install` locally first

### PDF Generation Fails

**Error**: "Could not find Chrome"
- **Fix**: Verify Puppeteer env vars:
  ```
  PUPPETEER_SKIP_CHROMIUM_DOWNLOAD=false
  PUPPETEER_EXECUTABLE_PATH=/usr/bin/chromium-browser
  ```
- **Fix**: Ensure disk is mounted at `/opt/render/.cache`

### BigQuery Fails

**Error**: "Could not authenticate"
- **Fix**: Check secret file path is exactly `/etc/secrets/bigquery-credentials.json`
- **Fix**: Verify JSON file content is valid
- **Fix**: Ensure `GOOGLE_APPLICATION_CREDENTIALS` env var is set

### VALD API Fails

**Error**: "401 Unauthorized"
- **Fix**: Verify all VALD credentials are correct
- **Fix**: Check for extra spaces in env vars
- **Fix**: Ensure tokens haven't expired

### App Shows 404 on Refresh

**Error**: React routes return 404
- **Fix**: This should be handled by server.js catch-all route
- **Fix**: Verify `NODE_ENV=production` is set
- **Fix**: Check build created `client/dist/index.html`

## üìã Environment Variables Quick Reference

```bash
# Required
NODE_ENV=production
JWT_SECRET=<auto-generated>
TRAINER_PASSWORD=<set-this>
VALD_CLIENT_ID=<from-vald>
VALD_CLIENT_SECRET=<from-vald>
VALD_USERNAME=<from-vald>
VALD_PASSWORD=<from-vald>
GOOGLE_APPLICATION_CREDENTIALS=/etc/secrets/bigquery-credentials.json
BIGQUERY_PROJECT_ID=vald-ref-data-copy
BIGQUERY_DATASET=VALDrefDataCOPY

# Puppeteer
PUPPETEER_EXECUTABLE_PATH=/usr/bin/chromium-browser
PUPPETEER_SKIP_CHROMIUM_DOWNLOAD=false
```

**Full list**: See `ENV_VARIABLES.md`

## üìö Documentation Reference

- **DEPLOYMENT.md**: Complete deployment guide with troubleshooting
- **ENV_VARIABLES.md**: All environment variables explained
- **render.yaml**: Render service configuration
- **.env.example**: Template for local development

## üîÑ Updating the Deployment

When you make changes:

1. Commit and push:
   ```bash
   git add .
   git commit -m "Your changes"
   git push
   ```

2. Render auto-deploys on push to `main`

3. Or manually deploy in dashboard: "Manual Deploy" ‚Üí "Deploy latest commit"

## üí∞ Cost Estimate

- **Free Tier**: $0/month (spins down after 15 min inactivity)
- **Starter**: $7/month (always-on, recommended for production)
- **Database** (if using PostgreSQL): $7/month

**Total**: $7-14/month for production

## ‚úÖ Final Checklist Before Going Live

- [ ] All features tested in production
- [ ] No errors in logs
- [ ] Performance is acceptable
- [ ] All environment variables secured (marked as "secret")
- [ ] Trainer password is strong
- [ ] BigQuery credentials uploaded correctly
- [ ] PDF generation works
- [ ] Professional group filtering works (10 athletes)
- [ ] Metric selector works for CMJ
- [ ] Custom domain configured (optional)
- [ ] Monitoring/alerts set up (optional)

## üÜò Need Help?

1. Check `DEPLOYMENT.md` for detailed troubleshooting
2. Review Render logs in dashboard
3. Test locally with `NODE_ENV=production`
4. Verify environment variables match `ENV_VARIABLES.md`
5. Check Render docs: https://render.com/docs

## üéâ You're Ready!

Once all checkboxes are complete, your app is deployed and ready to use!

**App URL**: `https://your-app-name.onrender.com`

**Login**:
- Username: `pushtrainer`
- Password: (the one you set)

---

**Note**: First deploy takes 5-10 minutes. Subsequent deploys are faster (2-3 minutes).

**Free Tier**: App spins down after 15 minutes of inactivity. First request after spin-down takes ~30 seconds to wake up. Upgrade to Starter plan for always-on.
