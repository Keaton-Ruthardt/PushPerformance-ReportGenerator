# Environment Variables Reference

Quick reference for all environment variables needed for Push Performance App deployment.

## How to Set in Render

1. Go to your web service in Render dashboard
2. Click "Environment" tab
3. Click "Add Environment Variable"
4. Add each variable below

## Required Environment Variables

### Application Configuration

```bash
NODE_ENV=production
PORT=5000
```

### Authentication

```bash
# JWT Secret (Click "Generate" in Render to auto-create)
JWT_SECRET=<auto-generated-by-render>

# Trainer Login Credentials
TRAINER_USERNAME=pushtrainer
TRAINER_PASSWORD=<your-secure-password-here>
```

### VALD API Configuration

```bash
# VALD API v3.3 Credentials
VALD_CLIENT_ID=<your-vald-client-id>
VALD_CLIENT_SECRET=<your-vald-client-secret>
VALD_USERNAME=<your-vald-email>
VALD_PASSWORD=<your-vald-password>

# VALD API Endpoints
VALD_PRIMARY_API=https://cloud.valdperformance.com/api/v3.3
VALD_SECONDARY_API=https://valdperformance.com/api/v3.3

# VALD API Tokens (if using token auth instead of OAuth)
VALD_PRIMARY_TOKEN=<your-primary-token>
VALD_SECONDARY_TOKEN=<your-secondary-token>
```

### BigQuery Configuration

```bash
BIGQUERY_PROJECT_ID=vald-ref-data-copy
BIGQUERY_DATASET=VALDrefDataCOPY
GOOGLE_APPLICATION_CREDENTIALS=/etc/secrets/bigquery-credentials.json
```

**Important**: Also upload your BigQuery credentials JSON file:
- Go to "Environment" → "Secret Files"
- Add file at path: `/etc/secrets/bigquery-credentials.json`
- Paste contents of `vald-ref-data-copy-0c0792ad4944.json`

### Puppeteer (PDF Generation)

```bash
PUPPETEER_SKIP_CHROMIUM_DOWNLOAD=false
PUPPETEER_EXECUTABLE_PATH=/usr/bin/chromium-browser
```

### Scheduled Tasks

```bash
# Cron schedule for percentile sync (3 AM daily)
PERCENTILE_SYNC_SCHEDULE=0 3 * * *
```

## Optional Environment Variables

### Database (PostgreSQL - if using)

```bash
# These are auto-filled by Render if you have a PostgreSQL database attached
DB_HOST=<auto-filled-from-database>
DB_PORT=<auto-filled-from-database>
DB_NAME=push_performance
DB_USER=<auto-filled-from-database>
DB_PASSWORD=<auto-filled-from-database>
```

### Legacy VALD API (older endpoints)

```bash
VALD_API_URL=https://api.vald.com
VALD_API_KEY=<legacy-key-if-needed>
VALD_API_SECRET=<legacy-secret-if-needed>
```

## Complete .env File Template (For Local Development)

Save this as `.env` in your project root for local development:

```bash
# Server Configuration
NODE_ENV=development
PORT=5000

# JWT Configuration
JWT_SECRET=your_local_jwt_secret_change_for_production

# Trainer Login
TRAINER_USERNAME=pushtrainer
TRAINER_PASSWORD=PushPerformance2025!

# VALD API v3.3 Configuration
VALD_CLIENT_ID=your_vald_client_id
VALD_CLIENT_SECRET=your_vald_client_secret
VALD_USERNAME=your_vald_username
VALD_PASSWORD=your_vald_password
VALD_PRIMARY_API=https://cloud.valdperformance.com/api/v3.3
VALD_SECONDARY_API=https://valdperformance.com/api/v3.3
VALD_PRIMARY_TOKEN=your_primary_token
VALD_SECONDARY_TOKEN=your_secondary_token

# BigQuery Configuration
BIGQUERY_PROJECT_ID=vald-ref-data-copy
BIGQUERY_DATASET=VALDrefDataCOPY
BIGQUERY_KEYFILE=vald-ref-data-copy-0c0792ad4944.json

# Percentile Sync Schedule
PERCENTILE_SYNC_SCHEDULE=0 3 * * *

# Puppeteer (for local PDF generation)
# Leave these empty for local dev - Puppeteer will auto-download Chromium
PUPPETEER_SKIP_CHROMIUM_DOWNLOAD=
PUPPETEER_EXECUTABLE_PATH=
```

## Checklist for Render Deployment

Before deploying, ensure you have:

- [ ] `NODE_ENV` set to `production`
- [ ] `JWT_SECRET` generated (use Render's "Generate" button)
- [ ] `TRAINER_PASSWORD` set to a strong password
- [ ] All VALD API credentials (`CLIENT_ID`, `CLIENT_SECRET`, `USERNAME`, `PASSWORD`)
- [ ] BigQuery credentials JSON file uploaded as secret file
- [ ] `GOOGLE_APPLICATION_CREDENTIALS` pointing to `/etc/secrets/bigquery-credentials.json`
- [ ] Puppeteer variables set
- [ ] Verified no typos in variable names

## Security Best Practices

### DO:
- ✅ Use Render's "Secret" type for sensitive variables
- ✅ Generate strong passwords for `TRAINER_PASSWORD`
- ✅ Use Render's auto-generated `JWT_SECRET`
- ✅ Upload BigQuery credentials as a secret file
- ✅ Regularly rotate VALD API credentials

### DON'T:
- ❌ Commit `.env` file to GitHub
- ❌ Share credentials in logs or error messages
- ❌ Use weak or default passwords
- ❌ Store credentials in code
- ❌ Use same passwords for dev and production

## Troubleshooting

### Variable not found error

**Error**: `process.env.VARIABLE_NAME is undefined`

**Solution**:
1. Check spelling matches exactly (case-sensitive)
2. Verify variable is saved in Render dashboard
3. Redeploy after adding new variables

### BigQuery authentication fails

**Error**: "Could not authenticate with Google Cloud"

**Solution**:
1. Verify secret file path: `/etc/secrets/bigquery-credentials.json`
2. Check JSON file contents are valid
3. Ensure `GOOGLE_APPLICATION_CREDENTIALS` variable is set
4. Verify service account has BigQuery permissions

### VALD API authentication fails

**Error**: "VALD API returned 401"

**Solution**:
1. Double-check all VALD credentials
2. Verify tokens haven't expired
3. Test credentials locally first
4. Check for trailing spaces in variables

## Testing Environment Variables Locally

Test your `.env` file before deploying:

```bash
# Load environment variables
cd "C:\Users\Jkeat\Push Performance\push-performance-app"

# Test server starts
npm run server

# Check logs for any missing variable warnings
# Press Ctrl+C to stop

# Test full build and start
npm run build
NODE_ENV=production npm run server
```

## Updating Variables

To update an environment variable in Render:

1. Go to web service → "Environment" tab
2. Find the variable
3. Click "Edit"
4. Update value
5. Click "Save"
6. Service will automatically redeploy

## References

- [Render Environment Variables Docs](https://render.com/docs/environment-variables)
- [Render Secret Files Docs](https://render.com/docs/configure-environment-variables#secret-files)
- [Node.js dotenv Package](https://github.com/motdotla/dotenv)
